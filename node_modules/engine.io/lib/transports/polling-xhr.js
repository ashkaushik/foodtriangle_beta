
/**
 * Module dependencies.
 */

var Polling = require('./polling');
<<<<<<< HEAD
var util = require('util');
=======
var Transport = require('../transport');
var debug = require('debug')('engine:polling-xhr');
>>>>>>> origin/foodtriangle_node

/**
 * Module exports.
 */

module.exports = XHR;

/**
 * Ajax polling transport.
 *
 * @api public
 */

<<<<<<< HEAD
function XHR (req) {
=======
function XHR(req){
>>>>>>> origin/foodtriangle_node
  Polling.call(this, req);
}

/**
 * Inherits from Polling.
 */

<<<<<<< HEAD
util.inherits(XHR, Polling);
=======
XHR.prototype.__proto__ = Polling.prototype;
>>>>>>> origin/foodtriangle_node

/**
 * Overrides `onRequest` to handle `OPTIONS`..
 *
<<<<<<< HEAD
 * @param {http.IncomingMessage}
=======
 * @param {http.ServerRequest}
>>>>>>> origin/foodtriangle_node
 * @api private
 */

XHR.prototype.onRequest = function (req) {
<<<<<<< HEAD
  if ('OPTIONS' === req.method) {
=======
  if ('OPTIONS' == req.method) {
>>>>>>> origin/foodtriangle_node
    var res = req.res;
    var headers = this.headers(req);
    headers['Access-Control-Allow-Headers'] = 'Content-Type';
    res.writeHead(200, headers);
    res.end();
  } else {
    Polling.prototype.onRequest.call(this, req);
  }
};

/**
 * Returns headers for a response.
 *
<<<<<<< HEAD
 * @param {http.IncomingMessage} request
=======
 * @param {http.ServerRequest} request
>>>>>>> origin/foodtriangle_node
 * @param {Object} extra headers
 * @api private
 */

<<<<<<< HEAD
XHR.prototype.headers = function (req, headers) {
=======
XHR.prototype.headers = function(req, headers){
>>>>>>> origin/foodtriangle_node
  headers = headers || {};

  if (req.headers.origin) {
    headers['Access-Control-Allow-Credentials'] = 'true';
    headers['Access-Control-Allow-Origin'] = req.headers.origin;
  } else {
    headers['Access-Control-Allow-Origin'] = '*';
  }

  return Polling.prototype.headers.call(this, req, headers);
};
